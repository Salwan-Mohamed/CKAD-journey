<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CKAD Multi-Container Scenarios</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        :root {
            --primary-color: #2563eb;
            --secondary-color: #1e40af;
            --accent-color: #3b82f6;
            --bg-color: #0f172a;
            --surface-color: #1e293b;
            --card-color: #334155;
            --text-primary: #f8fafc;
            --text-secondary: #cbd5e1;
            --text-muted: #94a3b8;
            --border-color: #475569;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --error-color: #ef4444;
            --code-bg: #1e1e1e;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: var(--bg-color);
            color: var(--text-primary);
            line-height: 1.6;
            overflow-x: hidden;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            padding: 2rem 0;
            text-align: center;
            box-shadow: 0 4px 20px rgba(37, 99, 235, 0.3);
        }

        .header h1 {
            font-size: 3rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.2rem;
            opacity: 0.9;
            max-width: 600px;
            margin: 0 auto;
        }

        /* Navigation */
        .nav-container {
            background: var(--surface-color);
            padding: 1rem 0;
            border-bottom: 1px solid var(--border-color);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .nav-links {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .nav-link {
            padding: 0.5rem 1rem;
            background: var(--card-color);
            border: none;
            border-radius: 8px;
            color: var(--text-primary);
            text-decoration: none;
            transition: all 0.3s ease;
            cursor: pointer;
            font-size: 0.9rem;
        }

        .nav-link:hover, .nav-link.active {
            background: var(--primary-color);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.4);
        }

        /* Search */
        .search-container {
            position: relative;
            min-width: 300px;
        }

        .search-input {
            width: 100%;
            padding: 0.75rem 1rem 0.75rem 3rem;
            border: 1px solid var(--border-color);
            border-radius: 25px;
            background: var(--card-color);
            color: var(--text-primary);
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
        }

        .search-icon {
            position: absolute;
            left: 1rem;
            top: 50%;
            transform: translateY(-50%);
            color: var(--text-muted);
        }

        /* Main Content */
        .main-content {
            padding: 2rem 0;
            min-height: calc(100vh - 200px);
        }

        .content-section {
            display: none;
            animation: fadeIn 0.5s ease-in-out;
        }

        .content-section.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Cards */
        .scenario-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
            margin: 2rem 0;
        }

        .scenario-card {
            background: var(--surface-color);
            border-radius: 12px;
            padding: 1.5rem;
            border: 1px solid var(--border-color);
            transition: all 0.3s ease;
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }

        .scenario-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            background: linear-gradient(90deg, var(--primary-color), var(--accent-color));
        }

        .scenario-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 30px rgba(0,0,0,0.3);
            border-color: var(--primary-color);
        }

        .scenario-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--text-primary);
        }

        .scenario-meta {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 0.85rem;
        }

        .scenario-badge {
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.75rem;
            font-weight: 500;
        }

        .badge-realworld { background: var(--success-color); color: white; }
        .badge-exam { background: var(--warning-color); color: white; }
        .badge-production { background: var(--primary-color); color: white; }
        .badge-troubleshooting { background: var(--error-color); color: white; }
        .badge-migration { background: #8b5cf6; color: white; }

        .scenario-description {
            color: var(--text-secondary);
            margin-bottom: 1rem;
            line-height: 1.5;
        }

        .scenario-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }

        .tag {
            background: var(--card-color);
            color: var(--text-muted);
            padding: 0.25rem 0.5rem;
            border-radius: 6px;
            font-size: 0.75rem;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            backdrop-filter: blur(4px);
        }

        .modal.active {
            display: flex;
            align-items: center;
            justify-content: center;
            animation: fadeIn 0.3s ease;
        }

        .modal-content {
            background: var(--surface-color);
            border-radius: 12px;
            max-width: 90vw;
            max-height: 90vh;
            overflow-y: auto;
            position: relative;
            border: 1px solid var(--border-color);
        }

        .modal-header {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: var(--card-color);
            border-radius: 12px 12px 0 0;
        }

        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            color: var(--text-muted);
            font-size: 1.5rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 6px;
            transition: all 0.3s ease;
        }

        .close-btn:hover {
            background: var(--error-color);
            color: white;
        }

        .modal-body {
            padding: 2rem;
        }

        /* Code blocks */
        .code-container {
            position: relative;
            margin: 1rem 0;
        }

        .copy-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            background: var(--primary-color);
            border: none;
            color: white;
            padding: 0.5rem;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            opacity: 0.8;
            transition: all 0.3s ease;
        }

        .copy-btn:hover {
            opacity: 1;
            transform: scale(1.05);
        }

        pre {
            background: var(--code-bg) !important;
            border-radius: 8px;
            padding: 1.5rem;
            overflow-x: auto;
            border: 1px solid var(--border-color);
        }

        code {
            font-family: 'Fira Code', 'Consolas', monospace;
            font-size: 0.9rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header h1 {
                font-size: 2rem;
            }

            .nav {
                flex-direction: column;
                text-align: center;
            }

            .search-container {
                min-width: 100%;
            }

            .scenario-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                max-width: 95vw;
                margin: 1rem;
            }
        }

        /* Stats */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 2rem 0;
        }

        .stat-card {
            background: var(--surface-color);
            padding: 1.5rem;
            border-radius: 12px;
            text-align: center;
            border: 1px solid var(--border-color);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stat-label {
            color: var(--text-secondary);
            margin-top: 0.5rem;
        }

        /* Loading */
        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 200px;
        }

        .spinner {
            width: 40px;
            height: 40px;
            border: 4px solid var(--border-color);
            border-top: 4px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .highlight {
            background: rgba(37, 99, 235, 0.2);
            padding: 0.1rem 0.2rem;
            border-radius: 3px;
        }

        .github-link {
            position: fixed;
            top: 20px;
            right: 20px;
            background: var(--surface-color);
            color: var(--text-primary);
            padding: 0.75rem;
            border-radius: 50%;
            text-decoration: none;
            font-size: 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            transition: all 0.3s ease;
            z-index: 1001;
        }

        .github-link:hover {
            background: var(--primary-color);
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <!-- GitHub Link -->
    <a href="https://github.com/Salwan-Mohamed/CKAD-journey" class="github-link" target="_blank" title="View on GitHub">
        <i class="fab fa-github"></i>
    </a>

    <div class="header">
        <div class="container">
            <h1><i class="fas fa-cube"></i> CKAD Multi-Container Scenarios</h1>
            <p>Comprehensive guide to mastering multi-container patterns for CKAD certification</p>
        </div>
    </div>

    <div class="nav-container">
        <div class="container">
            <div class="nav">
                <div class="nav-links">
                    <button class="nav-link active" onclick="showSection('overview')">
                        <i class="fas fa-home"></i> Overview
                    </button>
                    <button class="nav-link" onclick="showSection('realworld')">
                        <i class="fas fa-globe"></i> Real-World
                    </button>
                    <button class="nav-link" onclick="showSection('exam')">
                        <i class="fas fa-certificate"></i> Exam Style
                    </button>
                    <button class="nav-link" onclick="showSection('production')">
                        <i class="fas fa-industry"></i> Production
                    </button>
                    <button class="nav-link" onclick="showSection('troubleshooting')">
                        <i class="fas fa-tools"></i> Troubleshooting
                    </button>
                    <button class="nav-link" onclick="showSection('migration')">
                        <i class="fas fa-exchange-alt"></i> Migration
                    </button>
                </div>
                <div class="search-container">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" class="search-input" placeholder="Search scenarios..." onkeyup="searchScenarios(this.value)">
                </div>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="container">
            <!-- Overview Section -->
            <div id="overview" class="content-section active">
                <h2>üìä Overview</h2>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-number">12</div>
                        <div class="stat-label">Total Scenarios</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">5</div>
                        <div class="stat-label">Pattern Types</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">3</div>
                        <div class="stat-label">Difficulty Levels</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-number">100%</div>
                        <div class="stat-label">CKAD Coverage</div>
                    </div>
                </div>

                <h3>üéØ Learning Objectives</h3>
                <div style="background: var(--surface-color); padding: 2rem; border-radius: 12px; margin: 1rem 0;">
                    <ul style="list-style: none; padding: 0;">
                        <li style="margin: 1rem 0;"><i class="fas fa-check-circle" style="color: var(--success-color); margin-right: 0.5rem;"></i> Master sidecar, ambassador, and adapter patterns</li>
                        <li style="margin: 1rem 0;"><i class="fas fa-check-circle" style="color: var(--success-color); margin-right: 0.5rem;"></i> Understand real-world multi-container use cases</li>
                        <li style="margin: 1rem 0;"><i class="fas fa-check-circle" style="color: var(--success-color); margin-right: 0.5rem;"></i> Practice CKAD exam-style scenarios</li>
                        <li style="margin: 1rem 0;"><i class="fas fa-check-circle" style="color: var(--success-color); margin-right: 0.5rem;"></i> Learn production-ready implementations</li>
                        <li style="margin: 1rem 0;"><i class="fas fa-check-circle" style="color: var(--success-color); margin-right: 0.5rem;"></i> Troubleshoot common multi-container issues</li>
                    </ul>
                </div>

                <h3>üöÄ Quick Start Guide</h3>
                <div style="background: var(--card-color); padding: 1.5rem; border-radius: 8px; border-left: 4px solid var(--primary-color);">
                    <ol style="color: var(--text-secondary);">
                        <li>Start with <strong>Real-World</strong> scenarios to understand patterns</li>
                        <li>Practice <strong>Exam Style</strong> questions for certification prep</li>
                        <li>Explore <strong>Production</strong> use cases for real-world application</li>
                        <li>Use <strong>Troubleshooting</strong> section for debugging skills</li>
                        <li>Check <strong>Migration</strong> scenarios for modernization strategies</li>
                    </ol>
                </div>

                <h3>üîß How to Use Locally</h3>
                <div style="background: var(--surface-color); padding: 1.5rem; border-radius: 8px; margin: 1rem 0;">
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">To run these scenarios in your local environment:</p>
                    <div class="code-container">
                        <button class="copy-btn" onclick="copyToClipboard(this)">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                        <pre><code class="language-bash"># Clone the repository
git clone https://github.com/Salwan-Mohamed/CKAD-journey.git
cd CKAD-journey

# Apply any scenario
kubectl apply -f multi-container-scenarios/scenarios/microservices-logging.yaml

# Check the pod status
kubectl get pods -w

# Debug if needed
kubectl describe pod &lt;pod-name&gt;
kubectl logs &lt;pod-name&gt; -c &lt;container-name&gt;</code></pre>
                    </div>
                </div>
            </div>

            <!-- Real-World Section -->
            <div id="realworld" class="content-section">
                <h2>üåç Real-World Scenarios</h2>
                <div class="scenario-grid" id="realworld-grid">
                    <!-- Scenarios will be loaded here -->
                </div>
            </div>

            <!-- Exam Section -->
            <div id="exam" class="content-section">
                <h2>üìú Exam-Style Scenarios</h2>
                <div class="scenario-grid" id="exam-grid">
                    <!-- Scenarios will be loaded here -->
                </div>
            </div>

            <!-- Production Section -->
            <div id="production" class="content-section">
                <h2>üè≠ Production Use Cases</h2>
                <div class="scenario-grid" id="production-grid">
                    <!-- Scenarios will be loaded here -->
                </div>
            </div>

            <!-- Troubleshooting Section -->
            <div id="troubleshooting" class="content-section">
                <h2>üîß Troubleshooting Scenarios</h2>
                <div class="scenario-grid" id="troubleshooting-grid">
                    <!-- Scenarios will be loaded here -->
                </div>
            </div>

            <!-- Migration Section -->
            <div id="migration" class="content-section">
                <h2>üîÑ Migration Scenarios</h2>
                <div class="scenario-grid" id="migration-grid">
                    <!-- Scenarios will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Modal -->
    <div id="scenarioModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modalTitle"></h3>
                <button class="close-btn" onclick="closeModal()">&times;</button>
            </div>
            <div class="modal-body" id="modalBody">
                <!-- Scenario details will be loaded here -->
            </div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>

    <script>
        // Scenario data
        const scenarios = {
            realworld: [
                {
                    id: 1,
                    title: "Microservices Logging Solution",
                    description: "Implement sidecar pattern with log aggregation for multiple microservices with different logging formats.",
                    tags: ["sidecar", "logging", "fluent-bit", "microservices"],
                    difficulty: "intermediate",
                    pattern: "Sidecar",
                    yaml: `apiVersion: v1
kind: Pod
metadata:
  name: microservice-with-logging
spec:
  volumes:
  - name: log-volume
    emptyDir: {}
  
  containers:
  # Main microservice
  - name: microservice
    image: my-microservice:latest
    volumeMounts:
    - name: log-volume
      mountPath: /var/log/app
    env:
    - name: LOG_LEVEL
      value: "info"
    - name: LOG_FORMAT
      value: "json"
  
  # Fluent Bit log collector sidecar
  - name: fluent-bit
    image: fluent/fluent-bit:1.9
    volumeMounts:
    - name: log-volume
      mountPath: /var/log/app
      readOnly: true
    - name: fluent-bit-config
      mountPath: /fluent-bit/etc/
    env:
    - name: OUTPUT_HOST
      value: "elasticsearch.logging.svc.cluster.local"
    - name: OUTPUT_PORT
      value: "9200"
  
  volumes:
  - name: fluent-bit-config
    configMap:
      name: fluent-bit-config`,
                    context: "You have multiple microservices that generate logs in different formats, and you need to centralize them for analysis.",
                    challenge: "Each service has different logging patterns: Service A (JSON), Service B (Plain text), Service C (Custom format)",
                    keyPoints: ["Sidecar containers for cross-cutting concerns", "Volume sharing for log collection", "Configuration management with ConfigMaps"]
                },
                {
                    id: 2,
                    title: "Database Connection Pooling",
                    description: "Implement ambassador pattern with PgBouncer for database connection pooling and failover capabilities.",
                    tags: ["ambassador", "pgbouncer", "database", "connection-pooling"],
                    difficulty: "advanced",
                    pattern: "Ambassador",
                    yaml: `apiVersion: v1
kind: Pod
metadata:
  name: app-with-db-proxy
spec:
  containers:
  # Application
  - name: web-app
    image: my-web-app:latest
    env:
    - name: DATABASE_URL
      value: "postgresql://app:password@localhost:5432/mydb"
    ports:
    - containerPort: 8080
  
  # PgBouncer ambassador
  - name: pgbouncer
    image: pgbouncer/pgbouncer:latest
    env:
    - name: DATABASES_HOST
      value: "postgres-primary.default.svc.cluster.local"
    - name: DATABASES_PORT
      value: "5432"
    - name: POOL_MODE
      value: "session"
    - name: MAX_CLIENT_CONN
      value: "100"
    - name: DEFAULT_POOL_SIZE
      value: "20"
    ports:
    - containerPort: 5432
    volumeMounts:
    - name: pgbouncer-config
      mountPath: /etc/pgbouncer
  
  volumes:
  - name: pgbouncer-config
    configMap:
      name: pgbouncer-config`,
                    context: "Your application needs to connect to a database with connection pooling and failover capabilities.",
                    challenge: "High connection overhead to database, need for connection pooling, database failover requirements",
                    keyPoints: ["Ambassador pattern for external service abstraction", "Connection pooling and resource optimization", "Service discovery and failover"]
                },
                {
                    id: 3,
                    title: "Legacy System Integration",
                    description: "Implement adapter pattern for protocol translation between modern API and legacy SOAP service.",
                    tags: ["adapter", "legacy", "soap", "xml-json"],
                    difficulty: "intermediate",
                    pattern: "Adapter",
                    yaml: `apiVersion: v1
kind: Pod
metadata:
  name: api-with-legacy-adapter
spec:
  containers:
  # Modern REST API
  - name: rest-api
    image: my-rest-api:latest
    ports:
    - containerPort: 8080
  
  # XML/JSON adapter
  - name: legacy-adapter
    image: xml-json-adapter:latest
    ports:
    - containerPort: 3000
    env:
    - name: LEGACY_SOAP_URL
      value: "http://legacy-system.company.com/soap"
    - name: BACKEND_REST_URL
      value: "http://localhost:8080"
    volumeMounts:
    - name: transformation-config
      mountPath: /config
  
  volumes:
  - name: transformation-config
    configMap:
      name: xml-json-transformation-rules`,
                    context: "You need to integrate a modern API with a legacy SOAP service that expects XML input/output.",
                    challenge: "Modern service produces JSON, legacy service expects XML, need bidirectional transformation",
                    keyPoints: ["Adapter pattern for format transformation", "Protocol translation between systems", "Configuration-driven transformations"]
                }
            ],
            exam: [
                {
                    id: 4,
                    title: "Multi-Container Debug Challenge",
                    description: "Fix a pod with two containers that should share files, but the sidecar container can't see files created by the main container.",
                    tags: ["debugging", "volumes", "permissions", "file-sharing"],
                    difficulty: "intermediate",
                    pattern: "Sidecar",
                    yaml: `# BROKEN Configuration
apiVersion: v1
kind: Pod
metadata:
  name: file-sharing-pod
spec:
  containers:
  - name: writer
    image: busybox
    command: ['sh', '-c', 'while true; do echo "data" > /app/file.txt; sleep 30; done']
    volumeMounts:
    - name: shared-volume
      mountPath: /app
  
  - name: reader
    image: busybox
    command: ['sh', '-c', 'while true; do cat /data/file.txt; sleep 30; done']
    volumeMounts:
    - name: shared-volume
      mountPath: /data  # Different mount path!
  
  volumes:
  - name: shared-volume
    emptyDir: {}

---
# FIXED Configuration
apiVersion: v1
kind: Pod
metadata:
  name: file-sharing-pod-fixed
spec:
  containers:
  - name: writer
    image: busybox
    command: ['sh', '-c', 'while true; do echo "$(date): data" > /shared/file.txt; sleep 30; done']
    volumeMounts:
    - name: shared-volume
      mountPath: /shared
    securityContext:
      runAsUser: 1000
      runAsGroup: 1000
  
  - name: reader
    image: busybox
    command: ['sh', '-c', 'while true; do if [ -f /shared/file.txt ]; then cat /shared/file.txt; else echo "File not found"; fi; sleep 30; done']
    volumeMounts:
    - name: shared-volume
      mountPath: /shared
    securityContext:
      runAsUser: 1000
      runAsGroup: 1000
  
  volumes:
  - name: shared-volume
    emptyDir: {}
  
  securityContext:
    fsGroup: 1000`,
                    context: "CKAD exam question: You have a pod with two containers that should share files, but the sidecar container can't see files created by the main container.",
                    challenge: "Issues to fix: 1. Mount paths are different between containers, 2. Missing proper volume definition, 3. Potential permission issues",
                    keyPoints: ["Consistent mount paths across containers", "Proper security contexts", "Volume permission management"]
                },
                {
                    id: 5,
                    title: "Resource Limit Problem",
                    description: "A pod with multiple containers keeps getting OOMKilled. Identify and fix the resource allocation issues.",
                    tags: ["debugging", "resources", "oom", "limits"],
                    difficulty: "intermediate",
                    pattern: "Resource Management",
                    yaml: `# BROKEN Configuration
apiVersion: v1
kind: Pod
metadata:
  name: resource-problem-pod
spec:
  containers:
  - name: memory-hungry-app
    image: memory-intensive-app:latest
    resources:
      requests:
        memory: "1Gi"
      limits:
        memory: "512Mi"  # Limit < Request!
  
  - name: cpu-intensive-sidecar
    image: cpu-intensive-sidecar:latest
    resources:
      requests:
        cpu: "2000m"
        memory: "256Mi"
      limits:
        cpu: "1000m"     # Limit < Request!
        memory: "128Mi"  # Limit < Request!

---
# FIXED Configuration
apiVersion: v1
kind: Pod
metadata:
  name: resource-fixed-pod
spec:
  containers:
  - name: memory-hungry-app
    image: memory-intensive-app:latest
    resources:
      requests:
        memory: "512Mi"
        cpu: "200m"
      limits:
        memory: "1Gi"
        cpu: "500m"
  
  - name: cpu-intensive-sidecar
    image: cpu-intensive-sidecar:latest
    resources:
      requests:
        memory: "128Mi"
        cpu: "500m"
      limits:
        memory: "256Mi"
        cpu: "1000m"`,
                    context: "A pod with multiple containers keeps getting OOMKilled during high load periods.",
                    challenge: "Resource limits are set incorrectly - some limits are lower than requests, causing pod failures",
                    keyPoints: ["Resource limits must be >= requests", "Monitor actual resource usage", "Set appropriate buffer in limits"]
                }
            ],
            production: [
                {
                    id: 6,
                    title: "High-Traffic Web Application",
                    description: "E-commerce platform with web app, Redis caching, metrics collection, log aggregation, and health monitoring.",
                    tags: ["production", "redis", "nginx", "metrics", "logging"],
                    difficulty: "advanced",
                    pattern: "Multiple Sidecars",
                    yaml: `apiVersion: v1
kind: Pod
metadata:
  name: ecommerce-app
  labels:
    app: ecommerce
    tier: frontend
spec:
  volumes:
  - name: app-logs
    emptyDir:
      sizeLimit: 2Gi
  - name: redis-data
    emptyDir:
      sizeLimit: 1Gi
  - name: nginx-config
    configMap:
      name: nginx-config
  
  containers:
  # Main web application
  - name: web-app
    image: ecommerce-web:v2.1
    ports:
    - containerPort: 8080
      name: http
    env:
    - name: REDIS_URL
      value: "redis://localhost:6379"
    - name: LOG_LEVEL
      value: "info"
    volumeMounts:
    - name: app-logs
      mountPath: /var/log/app
    resources:
      requests:
        memory: "512Mi"
        cpu: "300m"
      limits:
        memory: "1Gi"
        cpu: "800m"
    livenessProbe:
      httpGet:
        path: /health
        port: 8080
      initialDelaySeconds: 30
      periodSeconds: 10
    readinessProbe:
      httpGet:
        path: /ready
        port: 8080
      initialDelaySeconds: 10
      periodSeconds: 5
  
  # Redis cache sidecar
  - name: redis-cache
    image: redis:6.2-alpine
    ports:
    - containerPort: 6379
    volumeMounts:
    - name: redis-data
      mountPath: /data
    resources:
      requests:
        memory: "256Mi"
        cpu: "100m"
      limits:
        memory: "512Mi"
        cpu: "200m"
    command: ["redis-server", "--maxmemory", "256mb", "--maxmemory-policy", "allkeys-lru"]
  
  # Nginx reverse proxy
  - name: nginx-proxy
    image: nginx:1.21-alpine
    ports:
    - containerPort: 80
    volumeMounts:
    - name: nginx-config
      mountPath: /etc/nginx/conf.d
    - name: app-logs
      mountPath: /var/log/nginx
    resources:
      requests:
        memory: "64Mi"
        cpu: "50m"
      limits:
        memory: "128Mi"
        cpu: "100m"`,
                    context: "E-commerce platform with high traffic requirements",
                    challenge: "Need web application serving HTTP traffic, Redis caching layer, metrics collection, log aggregation, and health monitoring",
                    keyPoints: ["Multi-container pod with multiple sidecars", "Resource planning and limits", "Health checks and monitoring", "Production-ready configuration"]
                },
                {
                    id: 7,
                    title: "Data Processing Pipeline",
                    description: "Batch data processing with multiple transformation stages, error handling, and retry logic.",
                    tags: ["data-pipeline", "batch", "transformation", "etl"],
                    difficulty: "advanced",
                    pattern: "Multi-stage Adapter",
                    yaml: `apiVersion: v1
kind: Pod
metadata:
  name: data-pipeline
spec:
  volumes:
  - name: raw-data
    emptyDir:
      sizeLimit: 5Gi
  - name: processed-data
    emptyDir:
      sizeLimit: 3Gi
  - name: pipeline-config
    configMap:
      name: pipeline-config
  
  initContainers:
  # Data ingestion
  - name: data-ingester
    image: data-ingester:latest
    env:
    - name: SOURCE_URL
      valueFrom:
        secretKeyRef:
          name: data-source-credentials
          key: url
    - name: API_KEY
      valueFrom:
        secretKeyRef:
          name: data-source-credentials
          key: api-key
    volumeMounts:
    - name: raw-data
      mountPath: /data/raw
    command: ["python", "/app/ingest.py"]
  
  containers:
  # CSV to JSON transformer
  - name: csv-json-transformer
    image: data-transformer:latest
    volumeMounts:
    - name: raw-data
      mountPath: /data/input
      readOnly: true
    - name: processed-data
      mountPath: /data/output
    - name: pipeline-config
      mountPath: /config
    env:
    - name: INPUT_FORMAT
      value: "csv"
    - name: OUTPUT_FORMAT
      value: "json"
    command: ["python", "/app/transform.py"]
  
  # Data validator
  - name: data-validator
    image: data-validator:latest
    volumeMounts:
    - name: processed-data
      mountPath: /data
    - name: pipeline-config
      mountPath: /config
    command: ["python", "/app/validate.py"]
  
  # Output adapter
  - name: output-adapter
    image: output-adapter:latest
    volumeMounts:
    - name: processed-data
      mountPath: /data/input
      readOnly: true
    env:
    - name: OUTPUT_DESTINATIONS
      value: "s3,elasticsearch,kafka"
    command: ["python", "/app/output.py"]`,
                    context: "Batch data processing with multiple transformation stages",
                    challenge: "Data ingestion from external source, multiple transformation steps, output to different formats, error handling and retry logic",
                    keyPoints: ["Multi-stage adapter pattern", "Init containers for dependencies", "Configuration-driven processing", "Multiple output destinations"]
                }
            ],
            troubleshooting: [
                {
                    id: 8,
                    title: "Container Communication Failure",
                    description: "Debug and fix containers in the same pod that can't communicate via localhost.",
                    tags: ["debugging", "networking", "localhost", "communication"],
                    difficulty: "intermediate",
                    pattern: "Troubleshooting",
                    yaml: `# Problem: Application binding to 127.0.0.1 instead of 0.0.0.0
# Solution: Ensure application binds to 0.0.0.0

apiVersion: v1
kind: Pod
metadata:
  name: communication-fixed
spec:
  containers:
  - name: main-app
    image: my-app:latest
    env:
    - name: BIND_ADDRESS
      value: "0.0.0.0"  # Not 127.0.0.1
    - name: PORT
      value: "8080"
    ports:
    - containerPort: 8080
  
  - name: sidecar
    image: my-sidecar:latest
    # Now can communicate with main-app via localhost:8080

# Debug commands:
# kubectl exec -it <pod> -c main-app -- netstat -tlnp
# kubectl exec -it <pod> -c sidecar -- curl localhost:8080`,
                    context: "Containers in the same pod can't communicate via localhost",
                    challenge: "curl: (7) Failed to connect to localhost port 8080: Connection refused",
                    keyPoints: ["Applications must bind to 0.0.0.0, not 127.0.0.1", "Containers share network namespace", "Debug with netstat and nc commands"]
                },
                {
                    id: 9,
                    title: "Volume Permission Issues",
                    description: "Sidecar container can't write to shared volume due to permission problems.",
                    tags: ["debugging", "volumes", "permissions", "security-context"],
                    difficulty: "intermediate",
                    pattern: "Troubleshooting",
                    yaml: `# Problem: Permission denied when writing to shared volume
# Solution: Use proper security contexts and fsGroup

apiVersion: v1
kind: Pod
metadata:
  name: volume-permissions-fixed
spec:
  securityContext:
    fsGroup: 2000  # Set group ownership for volumes
  
  initContainers:
  - name: permission-fix
    image: busybox
    command: ['sh', '-c', 'chmod 777 /shared && chown 1000:2000 /shared']
    volumeMounts:
    - name: shared-volume
      mountPath: /shared
    securityContext:
      runAsUser: 0  # Run as root for permission changes
  
  containers:
  - name: main-app
    image: my-app:latest
    securityContext:
      runAsUser: 1000
      runAsGroup: 2000
    volumeMounts:
    - name: shared-volume
      mountPath: /shared
  
  - name: sidecar
    image: my-sidecar:latest
    securityContext:
      runAsUser: 1000
      runAsGroup: 2000
    volumeMounts:
    - name: shared-volume
      mountPath: /shared
  
  volumes:
  - name: shared-volume
    emptyDir: {}`,
                    context: "Sidecar container can't write to shared volume",
                    challenge: "touch: /shared/test: Permission denied",
                    keyPoints: ["Use fsGroup in pod securityContext", "Consistent user/group IDs", "Init containers for permission setup"]
                }
            ],
            migration: [
                {
                    id: 10,
                    title: "Monolith to Microservices Migration",
                    description: "Gradual migration strategy using sidecars to extract microservices from a monolithic application.",
                    tags: ["migration", "monolith", "microservices", "strangler-pattern"],
                    difficulty: "advanced",
                    pattern: "Migration Strategy",
                    yaml: `# Phase 1: Add sidecars to existing monolith
apiVersion: v1
kind: Pod
metadata:
  name: monolith-with-sidecars
spec:
  containers:
  # Existing monolith (unchanged)
  - name: monolith
    image: legacy-monolith:latest
    ports:
    - containerPort: 8080
  
  # New microservice as sidecar
  - name: user-service
    image: user-microservice:latest
    ports:
    - containerPort: 8081
    env:
    - name: LEGACY_API_URL
      value: "http://localhost:8080"
  
  # API gateway for routing
  - name: api-gateway
    image: nginx:alpine
    ports:
    - containerPort: 80
    volumeMounts:
    - name: gateway-config
      mountPath: /etc/nginx/conf.d
  
  volumes:
  - name: gateway-config
    configMap:
      name: migration-gateway-config

---
# Phase 2: Extract more services
apiVersion: v1
kind: Pod
metadata:
  name: partial-migration
spec:
  containers:
  # Reduced monolith
  - name: core-monolith
    image: core-monolith:v2
    ports:
    - containerPort: 8080
  
  # Extracted microservices
  - name: user-service
    image: user-service:latest
    ports:
    - containerPort: 8081
  
  - name: order-service
    image: order-service:latest
    ports:
    - containerPort: 8082`,
                    context: "Migrating a monolithic application to microservices architecture",
                    challenge: "Need gradual migration without breaking existing functionality",
                    keyPoints: ["Strangler Fig pattern", "Gradual service extraction", "API gateway for routing", "Backward compatibility"]
                },
                {
                    id: 11,
                    title: "Cloud Provider Migration",
                    description: "Migrating from one cloud provider to another with different APIs using adapter pattern.",
                    tags: ["migration", "cloud", "adapter", "abstraction"],
                    difficulty: "advanced",
                    pattern: "Cloud Abstraction",
                    yaml: `apiVersion: v1
kind: Pod
metadata:
  name: cloud-agnostic-app
spec:
  containers:
  # Main application (cloud-agnostic)
  - name: application
    image: my-app:latest
    env:
    - name: STORAGE_API_URL
      value: "http://localhost:3000"
    - name: METRICS_API_URL
      value: "http://localhost:3001"
  
  # Storage API adapter
  - name: storage-adapter
    image: cloud-storage-adapter:latest
    ports:
    - containerPort: 3000
    env:
    - name: CLOUD_PROVIDER
      value: "aws"  # or "gcp", "azure"
    - name: AWS_ACCESS_KEY_ID
      valueFrom:
        secretKeyRef:
          name: cloud-credentials
          key: access-key
    - name: AWS_SECRET_ACCESS_KEY
      valueFrom:
        secretKeyRef:
          name: cloud-credentials
          key: secret-key
  
  # Metrics API adapter
  - name: metrics-adapter
    image: cloud-metrics-adapter:latest
    ports:
    - containerPort: 3001
    env:
    - name: METRICS_PROVIDER
      value: "cloudwatch"  # or "stackdriver", "azure-monitor"`,
                    context: "Migrating from one cloud provider to another with different APIs",
                    challenge: "Applications tightly coupled to specific cloud provider APIs need to be made cloud-agnostic",
                    keyPoints: ["Adapter pattern for cloud abstraction", "Configuration-driven cloud selection", "API compatibility layer", "Gradual migration strategy"]
                }
            ]
        };

        // Current active section and search term
        let currentSection = 'overview';
        let searchTerm = '';

        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            loadScenarios();
            Prism.highlightAll();
        });

        // Show specific section
        function showSection(section) {
            // Update navigation
            document.querySelectorAll('.nav-link').forEach(link => {
                link.classList.remove('active');
            });
            event.target.classList.add('active');

            // Update content
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(section).classList.add('active');

            currentSection = section;
        }

        // Load scenarios into grids
        function loadScenarios() {
            Object.keys(scenarios).forEach(category => {
                const grid = document.getElementById(`${category}-grid`);
                if (grid) {
                    grid.innerHTML = '';
                    scenarios[category].forEach(scenario => {
                        const card = createScenarioCard(scenario, category);
                        grid.appendChild(card);
                    });
                }
            });
        }

        // Create scenario card
        function createScenarioCard(scenario, category) {
            const card = document.createElement('div');
            card.className = 'scenario-card';
            card.onclick = () => showScenarioModal(scenario);

            const badgeClass = `badge-${category}`;
            const difficultyIcon = scenario.difficulty === 'beginner' ? 'fa-star' : 
                                 scenario.difficulty === 'intermediate' ? 'fa-star-half-alt' : 'fa-star';

            card.innerHTML = `
                <div class="scenario-title">${scenario.title}</div>
                <div class="scenario-meta">
                    <span class="scenario-badge ${badgeClass}">${category.toUpperCase()}</span>
                    <span style="color: var(--text-muted);">
                        <i class="fas ${difficultyIcon}"></i> ${scenario.difficulty}
                    </span>
                    <span style="color: var(--text-muted);">
                        <i class="fas fa-layer-group"></i> ${scenario.pattern}
                    </span>
                </div>
                <div class="scenario-description">${scenario.description}</div>
                <div class="scenario-tags">
                    ${scenario.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                </div>
            `;

            return card;
        }

        // Show scenario modal
        function showScenarioModal(scenario) {
            const modal = document.getElementById('scenarioModal');
            const title = document.getElementById('modalTitle');
            const body = document.getElementById('modalBody');

            title.textContent = scenario.title;
            
            body.innerHTML = `
                <div style="margin-bottom: 2rem;">
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">üìã Context</h4>
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">${scenario.context}</p>
                    
                    <h4 style="color: var(--warning-color); margin-bottom: 1rem;">‚ö° Challenge</h4>
                    <p style="color: var(--text-secondary); margin-bottom: 1rem;">${scenario.challenge}</p>
                </div>
                
                <div style="margin-bottom: 2rem;">
                    <h4 style="color: var(--success-color); margin-bottom: 1rem;">üí° Solution</h4>
                    <div class="code-container">
                        <button class="copy-btn" onclick="copyToClipboard(this)">
                            <i class="fas fa-copy"></i> Copy
                        </button>
                        <pre><code class="language-yaml">${scenario.yaml}</code></pre>
                    </div>
                </div>
                
                <div>
                    <h4 style="color: var(--accent-color); margin-bottom: 1rem;">üîë Key Learning Points</h4>
                    <ul style="color: var(--text-secondary);">
                        ${scenario.keyPoints.map(point => `<li style="margin: 0.5rem 0;">${point}</li>`).join('')}
                    </ul>
                </div>
            `;

            modal.classList.add('active');
            
            // Re-highlight syntax
            setTimeout(() => {
                Prism.highlightAll();
            }, 100);
        }

        // Close modal
        function closeModal() {
            document.getElementById('scenarioModal').classList.remove('active');
        }

        // Copy to clipboard
        function copyToClipboard(button) {
            const codeBlock = button.nextElementSibling.querySelector('code');
            const text = codeBlock.textContent;
            
            navigator.clipboard.writeText(text).then(() => {
                const originalText = button.innerHTML;
                button.innerHTML = '<i class="fas fa-check"></i> Copied!';
                button.style.background = 'var(--success-color)';
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.style.background = 'var(--primary-color)';
                }, 2000);
            });
        }

        // Search scenarios
        function searchScenarios(term) {
            searchTerm = term.toLowerCase();
            
            Object.keys(scenarios).forEach(category => {
                const grid = document.getElementById(`${category}-grid`);
                if (grid) {
                    grid.innerHTML = '';
                    
                    const filteredScenarios = scenarios[category].filter(scenario => {
                        return scenario.title.toLowerCase().includes(searchTerm) ||
                               scenario.description.toLowerCase().includes(searchTerm) ||
                               scenario.tags.some(tag => tag.toLowerCase().includes(searchTerm)) ||
                               scenario.pattern.toLowerCase().includes(searchTerm);
                    });
                    
                    filteredScenarios.forEach(scenario => {
                        const card = createScenarioCard(scenario, category);
                        grid.appendChild(card);
                    });
                    
                    if (filteredScenarios.length === 0 && term) {
                        grid.innerHTML = `
                            <div style="text-align: center; color: var(--text-muted); grid-column: 1 / -1; padding: 2rem;">
                                <i class="fas fa-search" style="font-size: 3rem; margin-bottom: 1rem; opacity: 0.5;"></i>
                                <p>No scenarios found matching "${term}"</p>
                            </div>
                        `;
                    }
                }
            });
        }

        // Close modal when clicking outside
        document.getElementById('scenarioModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeModal();
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                closeModal();
            }
        });
    </script>
</body>
</html>